const t={Z:[],L:[{x:0,y:1}],M:[{x:0,y:1}],A:[{x:0,y:1},{x:5,y:6}],C:[{x:0,y:1},{x:2,y:3},{x:4,y:5}],Q:[{x:0,y:1},{x:2,y:3}]};class e{constructor(t,e=[]){this.type=t,this.values=e}stringify(){return this.type+this.values.join(" ")}toExternal(){const{type:t,values:e}=this;return{type:t,values:e}}transformSelf(t){return n(this,t,this)}transform(t){return n(this,t)}}function n(n,i,a){const{values:r,type:s}=n;if(a||(a=new e(s,r.slice())),!(i instanceof DOMMatrix))return a;const o=t[s];for(const{x:t,y:e}of o){const n=i.transformPoint({x:r[t],y:r[e]});a.values[t]=n.x,a.values[e]=n.y}return a}const i=2*Math.PI;function a(t){return Math.abs(t)}function r(t){return 180*t/Math.PI}function s(t){return t*Math.PI/180}function o(t){return!t.some((t=>void 0!==t&&!Number.isFinite(t)))}function h(t,e){return a(t-e)<1e-6}function c(t,e,n,i,r,s){const{sin:o,cos:h}=Math,c=a(n)*h(s),f=a(i)*o(s);return[t+h(r)*c-o(r)*f,e+o(r)*c+h(r)*f]}function f(t,n,i,o,h,f,u,l){const{x1:d,y1:p,x2:g,y2:x,fa:m,fs:y}=function(t,e,n,i,r,s,o){const[h,f]=c(t,e,n,i,r,s),[u,l]=c(t,e,n,i,r,s+o);return{x1:h,y1:f,x2:u,y2:l,fa:a(o)>Math.PI?1:0,fs:o>0?1:0}}(t,n,i,o,h,s(f),s(u)),P=new e("A",[i,o,r(h),m,y,g,x]),{lastPoint:v}=this;l&&this.lineTo(d,p),v.x=g,v.y=x,this.push(P)}function u(t){return`Failed to execute 'roundRect' on '${function(t){return Object(t)===t&&t instanceof Path2D?"Path2D":t instanceof globalThis?.CanvasRenderingContext2D?"CanvasRenderingContext2D":t instanceof globalThis?.OffscreenCanvasRenderingContext2D?"OffscreenCanvasRenderingContext2D":t?.constructor.name||t}(t)}':`}var l=Object.freeze({__proto__:null,closePath:function(){this.push(new e("Z"))},lineTo:function(t,n){if(this.isEmpty())return void this.moveTo(t,n);if(!o([t,n]))return;this.push(new e("L",[t,n]));const{lastPoint:i}=this;i.x=t,i.y=n},moveTo:function(t,n){if(!o([t,n]))return;this.push(new e("M",[t,n]));const{lastPoint:i}=this;i.x=t,i.y=n},rect:function(t,e,n,i){this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.closePath();const{lastPoint:a}=this;a.x=t,a.y=e},ellipse:function(t,e,n,s,c,u,l,d=!1){if(!o([t,e,n,s,c,u,l]))return;if(n<0||s<0)throw new DOMException("radii cannot be negative","IndexSizeError");let p=u%i;p<=0&&(p+=i);let g=p-u;u=p,l+=g,!d&&l-u>=i?l=u+i:d&&u-l>=i?l=u-i:!d&&u>l?l=u+(i-(u-l)%i):d&&u<l&&(l=u-(i-(l-u)%i));let x=r(l-u),m=r(u);if(h(a(x),360)){const i=x/2;f.call(this,t,e,n,s,c,m,i,!0),f.call(this,t,e,n,s,c,m+i,i,!1)}else f.call(this,t,e,n,s,c,m,x,!0)},arc:function(t,e,n,i,a,r=!1){return this.ellipse(t,e,n,n,0,i,a,r)},bezierCurveTo:function(t,n,i,a,r,s){if(!o([t,n,i,a,r,s]))return;this.ensureThereIsASubpath(t,n),this.push(new e("C",[t,n,i,a,r,s]));const{lastPoint:h}=this;h.x=r,h.y=s},quadraticCurveTo:function(t,n,i,a){if(!o([t,n,i,a]))return;this.ensureThereIsASubpath(t,n),this.push(new e("Q",[t,n,i,a]));const{lastPoint:r}=this;r.x=i,r.y=a},arcTo:function(t,n,i,a,r){if(!o([t,n,i,a,r]))return;if(this.ensureThereIsASubpath(t,n),r<0)throw new DOMException("radii cannot be negative","IndexSizeError");const{lastPoint:s}=this,c=s.x,f=s.y,u=i-t,l=a-n,d=c-t,p=f-n,g=d*d+p*p;if(this.isEmpty())this.moveTo(t,n);else{if(g<=1e-6)return;if(h(p*u,l*d)||!r)this.lineTo(t,n);else{const o=i-c,x=a-f,m=u*u+l*l,y=o*o+x*x,P=Math.sqrt(m),v=Math.sqrt(g),M=m+g-y,w=2*P*v,b=Math.acos(M/w),C=r*Math.tan((Math.PI-b)/2),T=C/v,D=C/P;h(T,1)||this.lineTo(t+T*d,n+T*p);const I=p*o>d*x?1:0,S=s.x=t+D*u,N=s.y=n+D*l;this.push(new e("A",[r,r,0,0,I,S,N]))}}},roundRect:function(t,e,n,i,a){function r(t){const{x:e,y:n,z:i,w:a}=t;return{x:e,y:n,z:i,w:a}}function s(t){return+t}function o(t){const e=s(t);return Number.isFinite(e)?{x:e,y:e}:Object(t)===t?{x:s(t.x??0),y:s(t.y??0)}:{x:NaN,y:NaN}}if(![t,e,n,i].every((t=>Number.isFinite(t))))return;let h,c,f,l;if(4===(a=function(t){const e=typeof t;return"undefined"===e||null===t?[0]:"function"===e?[NaN]:"object"===e?"function"==typeof t[Symbol.iterator]?[...t].map((t=>{const e=typeof t;return"undefined"===e||null===t?0:"function"===e?NaN:"object"===e?r(t):s(t)})):[r(t)]:[s(t)]}(a)).length)h=o(a[0]),c=o(a[1]),f=o(a[2]),l=o(a[3]);else if(3===a.length)h=o(a[0]),c=o(a[1]),l=o(a[1]),f=o(a[2]);else if(2===a.length)h=o(a[0]),f=o(a[0]),c=o(a[1]),l=o(a[1]);else{if(1!==a.length)throw new RangeError(`${u(this)} ${a.length} is not a valid size for radii sequence.`);h=o(a[0]),c=o(a[0]),f=o(a[0]),l=o(a[0])}const d=[h,c,f,l],p=d.find((({x:t,y:e})=>t<0||e<0));if(!d.some((({x:t,y:e})=>!Number.isFinite(t)||!Number.isFinite(e)))){if(p)throw new RangeError(`${u(this)} Radius value ${p} is negative.`);!function(t){const[e,a,r,s]=t,o=[Math.abs(n)/(e.x+a.x),Math.abs(i)/(a.y+r.y),Math.abs(n)/(r.x+s.x),Math.abs(i)/(e.y+s.y)],h=Math.min(...o);if(h<=1)for(const e of t)e.x*=h,e.y*=h}(d),n<0&&i<0?(this.moveTo(t-h.x,e),this.ellipse(t+n+c.x,e-c.y,c.x,c.y,0,1.5*-Math.PI,-Math.PI),this.ellipse(t+n+f.x,e+i+f.y,f.x,f.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-l.x,e+i+l.y,l.x,l.y,0,-Math.PI/2,0),this.ellipse(t-h.x,e-h.y,h.x,h.y,0,0,-Math.PI/2)):n<0?(this.moveTo(t-h.x,e),this.ellipse(t+n+c.x,e+c.y,c.x,c.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+n+f.x,e+i-f.y,f.x,f.y,0,-Math.PI,1.5*-Math.PI,1),this.ellipse(t-l.x,e+i-l.y,l.x,l.y,0,Math.PI/2,0,1),this.ellipse(t-h.x,e+h.y,h.x,h.y,0,0,-Math.PI/2,1)):i<0?(this.moveTo(t+h.x,e),this.ellipse(t+n-c.x,e-c.y,c.x,c.y,0,Math.PI/2,0,1),this.ellipse(t+n-f.x,e+i+f.y,f.x,f.y,0,0,-Math.PI/2,1),this.ellipse(t+l.x,e+i+l.y,l.x,l.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+h.x,e-h.y,h.x,h.y,0,-Math.PI,1.5*-Math.PI,1)):(this.moveTo(t+h.x,e),this.ellipse(t+n-c.x,e+c.y,c.x,c.y,0,-Math.PI/2,0),this.ellipse(t+n-f.x,e+i-f.y,f.x,f.y,0,0,Math.PI/2),this.ellipse(t+l.x,e+i-l.y,l.x,l.y,0,Math.PI/2,Math.PI),this.ellipse(t+h.x,e+h.y,h.x,h.y,0,Math.PI,1.5*Math.PI)),this.closePath(),this.moveTo(t,e)}}}),d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},p=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function g(t){return t>=48&&t<=57}function x(t){return t>=48&&t<=57||43===t||45===t||46===t}function m(t){this.index=0,this.path=t,this.max=t.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function y(t){for(;t.index<t.max&&(10===(e=t.path.charCodeAt(t.index))||13===e||8232===e||8233===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&p.indexOf(e)>=0);)t.index++;var e}function P(t){var e=t.path.charCodeAt(t.index);return 48===e?(t.param=0,void t.index++):49===e?(t.param=1,void t.index++):void(t.err="SvgPath: arc flag can be 0 or 1 only (at pos "+t.index+")")}function v(t){var e,n=t.index,i=n,a=t.max,r=!1,s=!1,o=!1,h=!1;if(i>=a)t.err="SvgPath: missed param (at pos "+i+")";else if(43!==(e=t.path.charCodeAt(i))&&45!==e||(e=++i<a?t.path.charCodeAt(i):0),g(e)||46===e){if(46!==e){if(r=48===e,e=++i<a?t.path.charCodeAt(i):0,r&&i<a&&e&&g(e))return void(t.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+n+")");for(;i<a&&g(t.path.charCodeAt(i));)i++,s=!0;e=i<a?t.path.charCodeAt(i):0}if(46===e){for(h=!0,i++;g(t.path.charCodeAt(i));)i++,o=!0;e=i<a?t.path.charCodeAt(i):0}if(101===e||69===e){if(h&&!s&&!o)return void(t.err="SvgPath: invalid float exponent (at pos "+i+")");if(43!==(e=++i<a?t.path.charCodeAt(i):0)&&45!==e||i++,!(i<a&&g(t.path.charCodeAt(i))))return void(t.err="SvgPath: invalid float exponent (at pos "+i+")");for(;i<a&&g(t.path.charCodeAt(i));)i++}t.index=i,t.param=parseFloat(t.path.slice(n,i))+0}else t.err="SvgPath: param should start with 0..9 or `.` (at pos "+i+")"}function M(t){var e,n;n=(e=t.path[t.segmentStart]).toLowerCase();var i=t.data;if("m"===n&&i.length>2&&(t.result.push([e,i[0],i[1]]),i=i.slice(2),n="l",e="m"===e?"l":"L"),"r"===n)t.result.push([e].concat(i));else for(;i.length>=d[n]&&(t.result.push([e].concat(i.splice(0,d[n]))),d[n]););}function w(t){var e,n,i,a,r,s=t.max;if(t.segmentStart=t.index,e=t.path.charCodeAt(t.index),n=97==(32|e),function(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}(e))if(a=d[t.path[t.index].toLowerCase()],t.index++,y(t),t.data=[],a){for(i=!1;;){for(r=a;r>0;r--){if(!n||3!==r&&4!==r?v(t):P(t),t.err.length)return void M(t);t.data.push(t.param),y(t),i=!1,t.index<s&&44===t.path.charCodeAt(t.index)&&(t.index++,y(t),i=!0)}if(!i){if(t.index>=t.max)break;if(!x(t.path.charCodeAt(t.index)))break}}M(t)}else M(t);else t.err="SvgPath: bad command "+t.path[t.index]+" (at pos "+t.index+")"}var b=3*Math.PI;function C(t,e,n,i){var a=t*n+e*i;return a>1&&(a=1),a<-1&&(a=-1),(t*i-e*n<0?-1:1)*Math.acos(a)}function T(t,e){var n=4/3*Math.tan(e/4),i=Math.cos(t),a=Math.sin(t),r=Math.cos(t+e),s=Math.sin(t+e);return[i,a,i-a*n,a+i*n,r+s*n,s-r*n,r,s]}function D(t,e,n,i,a,r,s,o,h){var c=Math.sin(h*b/360),f=Math.cos(h*b/360),u=f*(t-n)/2+c*(e-i)/2,l=-c*(t-n)/2+f*(e-i)/2;if(0===u&&0===l)return[];if(0===s||0===o)return[];s=Math.abs(s),o=Math.abs(o);var d=u*u/(s*s)+l*l/(o*o);d>1&&(s*=Math.sqrt(d),o*=Math.sqrt(d));var p=function(t,e,n,i,a,r,s,o,h,c){var f=c*(t-n)/2+h*(e-i)/2,u=-h*(t-n)/2+c*(e-i)/2,l=s*s,d=o*o,p=f*f,g=u*u,x=l*d-l*g-d*p;x<0&&(x=0),x/=l*g+d*p;var m=(x=Math.sqrt(x)*(a===r?-1:1))*s/o*u,y=x*-o/s*f,P=c*m-h*y+(t+n)/2,v=h*m+c*y+(e+i)/2,M=(f-m)/s,w=(u-y)/o,T=(-f-m)/s,D=(-u-y)/o,I=C(1,0,M,w),S=C(M,w,T,D);return 0===r&&S>0&&(S-=b),1===r&&S<0&&(S+=b),[P,v,I,S]}(t,e,n,i,a,r,s,o,c,f),g=[],x=p[2],m=p[3],y=Math.max(Math.ceil(Math.abs(m)/(b/4)),1);m/=y;for(var P=0;P<y;P++)g.push(T(x,m)),x+=m;return g.map((function(t){for(var e=0;e<t.length;e+=2){var n=t[e+0],i=t[e+1],a=f*(n*=s)-c*(i*=o),r=c*n+f*i;t[e+0]=a+p[0],t[e+1]=r+p[1]}return t}))}function I(t){if(!(this instanceof I))return new I(t);var e=function(t){var e=new m(t),n=e.max;for(y(e);e.index<n&&!e.err.length;)w(e);return e.result.length&&("mM".indexOf(e.result[0][0])<0?(e.err="SvgPath: string should start with `M` or `m`",e.result=[]):e.result[0][0]="M"),{err:e.err,segments:e.result}}(t);this.segments=e.segments,this.err=e.err}I.from=function(t){if("string"==typeof t)return new I(t);if(t instanceof I){var e=new I("");return e.err=t.err,e.segments=t.segments.map((function(t){return t.slice()})),e}throw new Error("SvgPath.from: invalid param type "+t)},I.prototype.toString=function(){for(var t="",e="",n=!1,i=0,a=this.segments.length;i<a;i++){var r=this.segments[i],s=r[0];s!==e||"m"===s||"M"===s?("m"===s&&"z"===e&&(t+=" "),t+=s,n=!1):n=!0;for(var o=1;o<r.length;o++){var h=r[o];1===o?n&&h>=0&&(t+=" "):h>=0&&(t+=" "),t+=h}e=s}return t},I.prototype.iterate=function(t){var e,n,i,a=this.segments,r={},s=!1,o=0,h=0,c=0,f=0;if(a.forEach((function(e,n){var i=t(e,n,o,h);Array.isArray(i)&&(r[n]=i,s=!0);var a=e[0]===e[0].toLowerCase();switch(e[0]){case"m":case"M":return o=e[1]+(a?o:0),h=e[2]+(a?h:0),c=o,void(f=h);case"h":case"H":return void(o=e[1]+(a?o:0));case"v":case"V":return void(h=e[1]+(a?h:0));case"z":case"Z":return o=c,void(h=f);default:o=e[e.length-2]+(a?o:0),h=e[e.length-1]+(a?h:0)}})),!s)return this;for(i=[],e=0;e<a.length;e++)if(void 0!==r[e])for(n=0;n<r[e].length;n++)i.push(r[e][n]);else i.push(a[e]);return this.segments=i,this},I.prototype.abs=function(){return this.iterate((function(t,e,n,i){var a,r=t[0],s=r.toUpperCase();if(r!==s)switch(t[0]=s,r){case"v":return void(t[1]+=i);case"a":return t[6]+=n,void(t[7]+=i);default:for(a=1;a<t.length;a++)t[a]+=a%2?n:i}}),!0),this},I.prototype.unarc=function(){return this.iterate((function(t,e,n,i){var a,r,s,o=[],h=t[0];return"A"!==h&&"a"!==h?null:("a"===h?(r=n+t[6],s=i+t[7]):(r=t[6],s=t[7]),0===(a=D(n,i,r,s,t[4],t[5],t[1],t[2],t[3])).length?[["a"===t[0]?"l":"L",t[6],t[7]]]:(a.forEach((function(t){o.push(["C",t[2],t[3],t[4],t[5],t[6],t[7]])})),o))})),this},I.prototype.unshort=function(){var t,e,n,i,a,r=this.segments;return this.iterate((function(s,o,h,c){var f,u=s[0],l=u.toUpperCase();o&&("T"===l?(f="t"===u,"Q"===(n=r[o-1])[0]?(t=n[1]-h,e=n[2]-c):"q"===n[0]?(t=n[1]-n[3],e=n[2]-n[4]):(t=0,e=0),i=-t,a=-e,f||(i+=h,a+=c),r[o]=[f?"q":"Q",i,a,s[1],s[2]]):"S"===l&&(f="s"===u,"C"===(n=r[o-1])[0]?(t=n[3]-h,e=n[4]-c):"c"===n[0]?(t=n[3]-n[5],e=n[4]-n[6]):(t=0,e=0),i=-t,a=-e,f||(i+=h,a+=c),r[o]=[f?"c":"C",i,a,s[1],s[2],s[3],s[4]]))})),this};const S={Z:t=>t.closePath(),M:(t,e)=>t.moveTo(...e),L:(t,e)=>t.lineTo(...e),C:(t,e)=>t.bezierCurveTo(...e),Q:(t,e)=>t.quadraticCurveTo(...e)};class N extends Array{constructor(t=""){if(super(),this.needNewSubpath=!0,"string"==typeof t){const e=new I(t).abs().unshort().unarc();if(!Array.isArray(e.segments))return;this.lastPoint={x:NaN,y:NaN};for(const[t,...n]of e.segments){const e=S[t];"function"==typeof e&&e(this,n)}}else if(t&&isNaN(t))for(const{type:n,values:i}of t)this.push(new e(n,i)),this.lastPoint=t.lastPoint}isEmpty(){return!this.length}stringify(){return this.map((t=>t.stringify())).join("")}toExternal(){return this.map((t=>t.toExternal()))}ensureThereIsASubpath(t,e){this.needNewSubPath&&this.moveTo(t,e)}addPath(t,e){const n=t.getPathData();for(let t of n)this.push(t.transform(e))}getPathData(){return Array.from(this).map((({type:t,values:e})=>({type:t,values:e})))}}function A(t,e,n,i){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.addPoint(t,e),this.addPoint(n,i)}Object.assign(N.prototype,l),A.prototype={width:function(){return this.x2-this.x1},height:function(){return this.y2-this.y1},addPoint:function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},addX:function(t){this.addPoint(t,null)},addY:function(t){this.addPoint(null,t)},addQuadraticCurve:function(t,e,n,i,a,r){const s=t+2/3*(n-t),o=e+2/3*(i-e),h=s+1/3*(a-t),c=o+1/3*(r-e);this.addBezierCurve(t,e,s,o,h,c,a,r)},addBezierCurve:function(t,e,n,i,a,r,s,o){const h=[t,e],c=[n,i],f=[a,r],u=[s,o];this.addPoint(h[0],h[1]),this.addPoint(u[0],u[1]);let l=0;function d(t){return Math.pow(1-t,3)*h[l]+3*Math.pow(1-t,2)*t*c[l]+3*(1-t)*Math.pow(t,2)*f[l]+Math.pow(t,3)*u[l]}for(l=0;l<=1;l++){const t=6*h[l]-12*c[l]+6*f[l],e=-3*h[l]+9*c[l]-9*f[l]+3*u[l],n=3*c[l]-3*h[l];if(0==e){if(0==t)continue;const e=-n/t;0<e&&e<1&&(0==l&&this.addX(d(e)),1==l&&this.addY(d(e)));continue}const i=Math.pow(t,2)-4*n*e;if(i<0)continue;const a=(-t+Math.sqrt(i))/(2*e);0<a&&a<1&&(0==l&&this.addX(d(a)),1==l&&this.addY(d(a)));const r=(-t-Math.sqrt(i))/(2*e);0<r&&r<1&&(0==l&&this.addX(d(r)),1==l&&this.addY(d(r)))}}};const O=globalThis.CanvasRenderingContext2D?.prototype,L=globalThis.OffscreenCanvasRenderingContext2D?.prototype,E=[[O,["clip","drawFocusIfNeeded","scrollPathIntoView","isPointInPath","isPointInStroke","fill","scrollPathIntoView","stroke"]],[L,["clip","isPointInPath","isPointInStroke","fill","stroke"]],[globalThis.Path2D.prototype,["addPath"]]];let R=globalThis.Path2D;const B=new WeakMap,k=new WeakMap,z=Symbol("currentPath");if("function"!=typeof R.prototype.getPathData){class t{constructor(...e){const n=e.map((e=>e instanceof t?e.getPathData():e));k.set(this,new N(...n))}getPathData(){return k.get(this)}setPathData(t){B.delete(this),k.set(this,new N(t))}toSVGString(){return k.get(this).stringify()}getBBox(){return function(t){const e=new I(t),n=new A;e.abs().unarc().unshort().iterate((function(t,e,i,a){switch(t[0]){case"M":case"L":n.addPoint(t[1],t[2]);break;case"H":n.addX(t[1]);break;case"V":n.addY(t[1]);break;case"Q":n.addQuadraticCurve(i,a,t[1],t[2],t[3],t[4]);break;case"C":n.addBezierCurve(i,a,t[1],t[2],t[3],t[4],t[5],t[6])}}));const{x1:i,y1:a,x2:r,y2:s}=n;return{left:Math.min(i,r),top:Math.min(a,s),right:Math.max(i,r),bottom:Math.max(a,s),width:Math.abs(i-r),height:Math.abs(a-s)}}(this.toSVGString())}get[z](){let t=B.get(this);return t||(t=new R(this.toSVGString()),B.set(this,t)),t}get[Symbol.toStringTag](){return"Path2D"}static __Path2D=R}for(const e of Object.keys(R.prototype))t.prototype[e]=function(...t){const n=k.get(this);n[e].call(n,...t)},t.prototype[e][Symbol.toString]=()=>`function ${e} {\n    [native code]\n}`;Object.defineProperty(globalThis,"Path2D",{value:t});for(const[e,n]of E)if(e)for(const i of n){const n=e[i];e[i]=function(...e){const i=e.map((e=>e instanceof t?e[z]:e));return n.apply(this,i)}}}else R=R.__Path2D;const j=["scale","rotate","translate","transform","getTransform","setTransform","resetTransform"],q=["closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","arcTo","rect","roundRect","arc","ellipse"];var V=["save","restore","reset","isContextLost","renderLayer",...j,"createLinearGradient","createRadialGradient","createConicGradient","createPattern","clearRect","fillRect","strokeRect","beginPath","fill","stroke","clip","isPointInPath","isPointInStroke","fillText","strokeText","measureText","drawImage","setLineDash","getLineDash",...q],G=["save","restore","reset","scale","rotate","translate","transform","getTransform","setTransform","resetTransform","createLinearGradient","createRadialGradient","createConicGradient","createPattern","isPointInPath","isPointInStroke","measureText","setLineDash","getLineDash","closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","arcTo","rect","roundRect","arc","ellipse"],H=new WeakMap;function Q(t){if(!t)return 0;const[,e,n]=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/),i=function(t){return"px"===t?1:0}(n);return e*i}function F(t){if(!t)return[0,0];let[e,n]=t.split(/\s+/);return[Q(e),Q(n)]}function $(t){if(!t)return 0;return Q(t.match(/\d/))}function _(t){const e=globalThis[t];return e&&this instanceof e}function W(t){const e=_.bind(t);return e("HTMLImageElement")?{width:t.naturalWidth,height:t.naturalHeight}:e("HTMLVideoElement")?{width:t.videoWidth,height:t.videoHeight}:e("SVGImageElement")?{width:NaN,height:NaN}:e("HTMLCanvasElement")||e("OffscreenCanvas")||e("ImageBitmap")||e("ImageData")?{width:t.width,height:t.height}:{width:NaN,height:NaN}}function X(t){let e=Z(0,0,0,0);const n=t.matchAll(/drop-shadow\((.*?)\)/g);for(const t of n){const[n,i]=F(t?.[1]);e=K(e,Z(n,i,n,i))}let i=0;const a=t.match(/blur\((.*?)\)/g)||[];for(const t of a)i=Math.max(i,$(t?.[1]));return et(e,{x:i,y:i})}function Y(t,e){const n=new Path2D;return n.addPath(t,e),n}function Z(t,e,n,i,a){const r={left:Math.min(t,n),top:Math.min(e,i),right:Math.max(t,n),bottom:Math.max(e,i)};return a?U(r,a):r}function U(t,e){const{left:n,top:i,right:a,bottom:r}=t,s=e.transformPoint({x:n,y:i}),o=e.transformPoint({x:a,y:i}),h=e.transformPoint({x:a,y:r}),c=[s,o,e.transformPoint({x:n,y:r}),h],f=Math.min(...c.map((t=>t.x))),u=Math.min(...c.map((t=>t.y))),l=Math.max(...c.map((t=>t.x))),d=Math.max(...c.map((t=>t.y)));return Z(Math.floor(f),Math.floor(u),Math.ceil(l),Math.ceil(d))}function J(t){return Z(t.left,t.top,t.right,t.bottom)}function K(t,e){return{left:Math.min(t.left,e.left),top:Math.min(t.top,e.top),right:Math.max(t.right,e.right),bottom:Math.max(t.bottom,e.bottom)}}function tt(t,e){return t?e?{left:Math.max(t.left,e.left),top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom)}:t:e}function et(t,e){const{left:n,top:i,right:a,bottom:r}=t;return Z(n-e.x,i-e.y,a+e.x,r+e.y)}function nt(t,e){const n=e.lineWidth*e.miterLimit/2;return et(t,{x:n,y:n})}function it(t,e){const{shadowOffsetX:n,shadowOffsetY:i,shadowBlur:a}=e;if(0===a)return t;const{left:r,top:s,right:o,bottom:h}=t;return Z(Math.min(r,r+n-a),Math.min(s,s+i-a),Math.max(o,o+n+a),Math.max(h,h+i+a))}function at(t,e){const{left:n,top:i,right:a,bottom:r}=t;return Z(n+e.left,i+e.top,a+e.right,r+e.bottom)}function rt([t,e,n],i){const a=i.measureText(t);return Z(-1*a.actualBoundingBoxLeft+e,-1*a.actualBoundingBoxAscent+n,a.actualBoundingBoxRight+e,a.actualBoundingBoxDescent+n)}function st(t,e){if(3===t.length){const[n,i,a]=t,{width:r,height:s}=W(n);return Z(i,a,i+r,a+s,e)}if(5===t.length){const[,n,i,a,r]=t;return Z(n,i,n+a,i+r,e)}if(9===t.length){const[,,,,,n,i,a,r]=t;return Z(n,i,n+a,i+r,e)}return Z(0,0,0,0)}function ot(t){const[{width:e,height:n},i,a]=t;return Z(i,a,i+e,a+n)}function ht(t){return t[0]instanceof DOMMatrix?t[0].toString():`matrix(${t.slice(0,6).join()})`}const ct={rotate(t){this.rotateSelf(t*(180/Math.PI))},scale(t,e){this.scaleSelf(t,e)},translate(t,e){this.translateSelf(t,e)},transform(...t){this.multiplySelf(new DOMMatrix(ht(t)))},setTransform(...t){this.setMatrixValue(ht(t))},resetTransform(){this.setMatrixValue(ht([1,0,0,1,0,0]))}};function ft(t,...e){const n=function(t,e){return e instanceof Path2D?e:H.get(t).innerPath}(t,e[0]),i=H.get(t);i.clipArea=tt(i.clipArea,n.getBBox())}function ut(t){H.set(t,{innerPath:new Path2D,bufferPath:new Path2D,bufferPathDirty:!1,clipArea:null,states:[]})}function lt(t){const e=t.prototype,{getContext:n}=e;e.getContext=function(...t){const e=n.call(this,...t);return e&&"2d"===t[0]&&!H.has(e)&&(ut(e),function(t,e){const n=Object.getPrototypeOf(t),{width:i,height:a}=Object.getOwnPropertyDescriptors(n);Object.defineProperties(t,{width:{...i,get:i.get,set:function(t){return ut(e),i.set.call(this,t)}},height:{...a,get:a.get,set:function(t){return ut(e),a.set.call(this,t)}}})}(this,e)),e}}function dt(t){const e=H.get(t),{bufferPathDirty:n,bufferPath:i,innerPath:a}=e;n&&(a.addPath(i,t.getTransform()),e.bufferPath=new Path2D,e.bufferPathDirty=!1)}function pt(t){const{clip:e,save:n,restore:i,reset:a,beginPath:r}=t;t.clip=function(...t){dt(this),ft(this,t[0]),e.call(this,...t)},t.save=function(...t){const e=H.get(this),{clipArea:i}=e;n.call(this,...t),e.states.push(i?J(i):i)},t.restore=function(...t){const e=H.get(this);i.call(this,...t),e.clipArea=e.states.pop()},t.reset=function(...t){const e=H.get(this);e.clipArea=Z(-1/0,-1/0,1/0,1/0),e.states.length=0,e.innerPath=new Path2D,e.bufferPath=new Path2D,e.bufferPathDirty=!1,a?.call(this,...t)},t.beginPath=function(...t){const e=H.get(this);e.innerPath=new Path2D,e.bufferPath=new Path2D,e.bufferPathDirty=!1,r.call(this,...t)},q.forEach((e=>{const n=t[e];t[e]=function(...t){const i=H.get(this);i.bufferPath[e](...t),i.bufferPathDirty=!0,n.call(this,...t)}})),["fill","stroke"].concat(j).forEach((e=>{if("getTransform"===e)return;const n=t[e];t[e]=function(...t){dt(this),n.call(this,...t)}}))}function gt(t,e){const n=function(t){if(!H.has(t))return t;const{canvas:e}=t,{clipArea:n}=H.get(t),i=t.getTransform().inverse(),a=n&&K(U(n,i),Z(0,0,0,0)),r=Z(0,0,e.width,e.height,i);return a?tt(r,a):r}(e),{commands:i,context:a}=H.get(t),r=[];let s=new DOMMatrix,o=new Path2D,h=Z(-1/0,-1/0,1/0,1/0),c=Z(0,0,0,0),f=Z(0,0,0,0);a.reset?a.reset():a.canvas.width+=0;for(const[t,e,n]of i)if("setter"===t&&(a[e]=n[0],"filter"===e&&(c=X(n[0]))),"method"===t)if("reset"===e)o=new Path2D,ct.resetTransform.call(s),f=Z(0,0,0,0);else if("beginPath"===e)o=new Path2D;else if("save"===e)r.push({clippingBox:h&&J(h),matrix:new DOMMatrix(s)});else if("restore"===e){const t=r.pop();t&&({clippingBox:h,matrix:s}=t)}else if("clip"===e)h=(n[0]instanceof Path2D?n[0]:o).getBBox();else if(e in ct)ct[e].call(s,...n);else if(q.includes(e)){const t=new Path2D;t[e](...n),o.addPath(t,s)}else if("stroke"===e){f=K(f,tt(it(at(U(nt((n[0]instanceof Path2D?Y(n[0],s):o).getBBox(),a),s),c),a),h))}else if("fill"===e){f=K(f,tt(it(at(U((n[0]instanceof Path2D?Y(n[0],s):o).getBBox(),s),c),a),h))}else if("fillRect"===e){const[t,e,i,r]=n;f=K(f,tt(it(at(Z(t,e,t+i,e+r,s),c),a),h))}else if("strokeRect"===e){const[t,e,i,r]=n;f=K(f,tt(it(at(U(nt(Z(t,e,t+i,e+r),a),s),c),a),h))}else if("fillText"===e){f=K(f,tt(it(at(U(rt(n,a),s),c),a),h))}else if("strokeText"===e){f=K(f,tt(it(at(U(nt(rt(n,a),a),s),c),a),h))}else if("drawImage"===e){f=K(f,tt(it(at(st(n,s),c),a),h))}else if("putImageData"===e){f=K(f,ot(n))}else if("renderLayer"===e){const{width:t,height:e}=gt(n[0],h);f=K(f,tt(it(at(Z(0,0,t,e,s),c),a),h))}f.left=Math.max(f.left,0),f.top=Math.max(f.top,0);const u=tt(n,f);return{width:u.right-u.left,height:u.bottom-u.top}}function xt(t){const{context:e,commands:n}=H.get(this),{canvas:i}=e,{width:a,height:r}=gt(this,t);a&&r&&(i.width=a,i.height=r,n.forEach((([t,n,i])=>{switch(t){case"method":e[n].call(e,...i);break;case"setter":e[n]=i[0]}})),t.drawImage(i,0,0),i.width=i.height=0)}"function"==typeof CanvasRenderingContext2D&&pt(CanvasRenderingContext2D.prototype),"function"==typeof OffscreenCanvasRenderingContext2D&&pt(OffscreenCanvasRenderingContext2D.prototype),"function"==typeof HTMLCanvasElement&&lt(HTMLCanvasElement),"function"==typeof OffscreenCanvas&&lt(OffscreenCanvas);class mt{constructor(){const t=("function"==typeof OffscreenCanvasRenderingContext2D?new OffscreenCanvas(1,1):Object.assign(document.createElement("canvas"),{width:1,height:1})).getContext("2d"),e=xt.bind(this),n=new Set;H.set(this,{commands:[],context:t,renderer:e,layersList:n})}clone(){const t=new mt,{commands:e,layersList:n}=H.get(this),i=H.get(t);return i.commands=e.slice(),i.layersList=new Set(...n.entries()),t}}function yt(t){H.get(t).renderer.call(t,this)}V.forEach((t=>{mt.prototype[t]=function(...e){const{commands:n,context:i}=H.get(this);if(n.push(["method",t,e]),"reset"===t&&(n.length=0),G.includes(t))return i[t](...e)}})),["globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","strokeStyle","fillStyle","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","filter","lineWidth","lineCap","lineJoin","miterLimit","lineDashOffset","font","textAlign","textBaseline","direction","letterSpacing","fontKerning","fontStretch","fontVariantCaps","textRendering","wordSpacing"].forEach((t=>{Object.defineProperty(mt.prototype,t,{get:function(){return H.get(this).context[t]},set:function(e){const{context:n,commands:i}=H.get(this);n[t]=e,i.push(["setter",t,[e]])}})})),mt.prototype.renderLayer=function(t){const{commands:e,layersList:n}=H.get(this),i=H.get(t).layersList;if([...i].forEach((t=>{if(H.get(t).layersList.has(this))throw new TypeError("cyclic CanvasLayer value");n.add(t)})),n.add(t),i.has(this)||n.has(this))throw new TypeError("cyclic CanvasLayer value");e.push(["method","renderLayer",[t]])},"function"==typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.renderLayer=yt),"function"==typeof OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.renderLayer=yt);export{mt as default};
